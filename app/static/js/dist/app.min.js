!function(){window.app=window.app||{},app.api_endpoint=function(n){return(n=n||{}).url=n.url||"",n.url=app.site_root()+n.url,$.ajax(n)};var n={};app.controller=function(t,o){n[t]=o},$(function(){$controlled=$("[data-controller]"),$controlled.each(function(t,o){$elem=$(o);var e=$elem.attr("data-controller");n[e]($elem)})})}(),function(){var n=app.api_endpoint;$.fn.aggregate=function(t){t=t||{};var o,e,a,i,r=$(this);o=t.source||null,e=t.params||{},t.record_template,i="<p>Nothing available at this time</p>",a=t.on_load||function(n){console.log(n),n||r.append(i)},pagination=t.pagination||!1,pagination&&(on_paginate=t.on_paginate||function(){},on_next=t.on_next||function(){},on_prev=t.on_prev||function(){}),n({url:o,method:"GET",data:"function"==typeof e?e():e}).then(a)}}(),function(){app.api_endpoint;$.fn.ajaxify=function(n){var t,o,e,a;t=(n=n||{}).on_validate||function(){return!0},o=n.on_send||function(){},e=n.on_result||function(){},a=n.on_error||function(){};var i=$(this);i.is("form")?i.submit(function(n){var r,l,c;n.preventDefault(),r=i.attr("method"),l=i.attr("action"),c=(c=$("input,textarea,select",i)).not("input[type=submit],input[type=radio]:not(:checked),input[type=checkbox]:not(:checked)");for(var u={},p=0;p<c.length;p++){var f,s;s=(f=$(c[p])).val(),u[f.attr("name")]=s}var d=t(u);if(!0===d){o(i);var g=window.setTimeout(function(){i.addClass("waiting")},500);api_endpoint({url:l,method:r,data:u}).then(function(n){window.clearTimeout(g),i.removeClass("waiting"),e(n),i.addClass("finished"),window.setTimeout(function(){i.removeClass("finished")},3e3)}).catch(function(n){a(n),i.addClass("error"),window.setTimeout(function(){i.removeClass("error")},3e3)})}else{var m=d.err_message||"form invalid";console.error(m)}}):console.error("ajaxify must be called on a form")}}(app),app.controller("listing-edit-form",function(n){n.ajaxify({on_result:function(){}})}),app.controller("listing-delete-form",function(n){n.ajaxify({on_result:function(){}})}),app.controller("user-edit-form",function(n){n.ajaxify({on_result:function(n){console.log(n)}})}),app.controller("user-delete-form",function(n){n.ajaxify({on_result:function(n){n.success&&(window.location=app.site_root())}})}),app.controller("user-profile",function(n){$(".aggregate.recently-sold",n),user_listings_aggregate=$(".aggregate.user-listing",n)}),app.controller("my-account",function(n){recently_bought_aggregate=$("aggregate.recently-bought",n)});